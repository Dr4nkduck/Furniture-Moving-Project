<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>PV-002 ‚Ä¢ B·∫£ng gi√° & d·ªãch v·ª• (Provider)</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Early theme boot: kh√¥ng nh·∫•p nh√°y khi ƒë·ªïi theme -->
    <script>
        (function () {
            try {
                var saved = localStorage.getItem('theme');
                var prefers = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                var dark = saved ? (saved === 'dark') : prefers;
                document.documentElement.classList.toggle('dark', !!dark);
                document.documentElement.dataset.theme = dark ? 'dark' : 'light';
            } catch (e) {}
        })();
    </script>

    <!-- CSRF (n·∫øu b·∫≠t Spring CSRF) -->
    <meta th:if="${_csrf != null}" name="_csrf" th:content="${_csrf.token}">
    <meta th:if="${_csrf != null}" name="_csrf_header" th:content="${_csrf.headerName}">
    <!-- (tu·ª≥ ch·ªçn) N·∫øu Controller render s·∫µn providerId -->
    <meta th:if="${providerId != null}" name="provider-id" th:content="${providerId}">

    <!-- DASHBOARD ASSETS -->
    <link rel="stylesheet" th:href="@{/dashbooard/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/dashbooard/css/style.css}">
    <link rel="stylesheet" th:href="@{/dashbooard/css/dashboard.css}">
    <link rel="stylesheet" th:href="@{/dashbooard/css/theme.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <!-- Page styles -->
    <style>
        :root{
            --bg: #ffffff;
            --text: #0f172a;
            --muted: #64748b;
            --surface: #ffffff;
            --surface-2: #f8fafc;
            --border: #e2e8f0;

            --brand-1: #667eea; /* indigo */
            --brand-2: #764ba2; /* purple */
            --accent-1: #11998e; --accent-2: #38ef7d;
            --danger-1: #ee0979; --danger-2: #ff6a00;
        }
        .dark:root{
            --bg: #0b1220;
            --text: #e5e7eb;
            --muted: #9aa4b2;
            --surface: #0f172a;
            --surface-2: #111827;
            --border: #334155;
        }

        html, body { background: var(--bg); color: var(--text); }

        .app-card{
            background: var(--surface);
            border: 1px solid var(--border);
            border-radius: 18px;
            box-shadow: 0 10px 30px rgba(0,0,0,.06);
        }

        .page-header{
            background: linear-gradient(135deg, var(--brand-1), var(--brand-2));
            color: #fff; border-radius: 18px; padding: 1.2rem 1.6rem;
        }

        .form-control, .form-select{
            background: var(--surface);
            border: 2px solid var(--border);
            color: var(--text);
            border-radius: 12px;
            padding: .7rem .9rem;
        }
        .form-control::placeholder { color: var(--muted); opacity: .8; }
        .form-control:focus, .form-select:focus{
            border-color: var(--brand-1);
            box-shadow: 0 0 0 4px rgba(102,126,234,.15);
        }
        .is-invalid{ border-color:#ef4444 !important; box-shadow:0 0 0 3px rgba(239,68,68,.18) !important; }
        .invalid-feedback{ display:block; font-size:.8rem; }

        .toolbar{
            background: linear-gradient(135deg, var(--surface-2), var(--surface));
            border: 1px solid var(--border);
            border-radius: 14px; padding: .8rem;
        }

        .table thead{
            background: linear-gradient(135deg, var(--brand-1), var(--brand-2));
            color:#fff;
        }
        .table td, .table th{ border-color: var(--border) !important; }
        .table-hover tbody tr:hover { background: rgba(102,126,234,.08); }

        /* Sidebar overlay (kh√¥ng ƒë·∫©y content) */
        .sidebar{position:fixed;top:0;left:0;bottom:0;width:280px;transform:translateX(-100%);transition:transform .25s;z-index:1030;background:var(--surface);border-right:1px solid var(--border)}
        .sidebar.open{transform:translateX(0)}
        .content,.content.open{margin-left:0!important}
        #sidebar-backdrop{position:fixed;inset:0;background:rgba(0,0,0,.35);opacity:0;pointer-events:none;transition:opacity .25s;z-index:1029}
        #sidebar-backdrop.show{opacity:1;pointer-events:auto}

        .navbar.sticky-top{
            backdrop-filter: blur(8px);
            background: color-mix(in srgb, var(--surface) 92%, transparent);
            border-bottom: 1px solid var(--border);
        }

        /* Add item block */
        .add-item-section{
            background: color-mix(in srgb, var(--accent-2) 12%, transparent);
            border: 2px dashed color-mix(in srgb, var(--accent-2) 60%, #000);
            border-radius: 14px; padding: .8rem;
        }

        /* Loading overlay */
        .loading-overlay{position:fixed;inset:0;display:none;align-items:center;justify-content:center;z-index:2000;background:rgba(0,0,0,.25)}
        .loading-overlay.show{display:flex}

        /* Toast container */
        .toast-wrap{position:fixed;top:12px;right:12px;z-index:1080}
    </style>
</head>
<body>
<div class="container-fluid position-relative d-flex p-0">

    <!-- Sidebar -->
    <div class="sidebar pe-3">
        <nav class="navbar navbar-light">
            <div class="px-3 py-3" style="background:linear-gradient(135deg,var(--brand-1),var(--brand-2));color:#fff">
                <h3 class="m-0"><i class="bi bi-box-seam me-2"></i>ProviderOP</h3>
            </div>
            <div class="navbar-nav w-100 px-3 mt-3">
                <a th:href="@{/provider/dashboard}" class="nav-item nav-link"><i class="bi bi-speedometer2 me-2"></i>T·ªïng quan</a>
                <a th:href="@{/provider/services}" class="nav-item nav-link active"><i class="bi bi-gear-wide-connected me-2"></i>B·∫£ng gi√° & d·ªãch v·ª•</a>
                <a th:href="@{/provider/orders}" class="nav-item nav-link"><i class="bi bi-box me-2"></i>ƒê∆°n h√†ng</a>
                <a th:href="@{/provider/analytics}" class="nav-item nav-link"><i class="bi bi-graph-up me-2"></i>Ph√¢n t√≠ch</a>
            </div>
        </nav>
    </div>

    <!-- Content -->
    <div class="content">
        <!-- Top Navbar -->
        <nav class="navbar navbar-expand navbar-light sticky-top px-3 py-2">
            <a href="#" class="sidebar-toggler flex-shrink-0" aria-label="Toggle sidebar"><i class="bi bi-list fs-4"></i></a>
            <div class="ms-auto d-flex align-items-center gap-2">
                <button id="theme-toggle" class="btn btn-sm btn-outline-secondary" type="button">
                    <i class="bi bi-moon-stars me-1"></i><span>Dark</span>
                </button>
            </div>
        </nav>

        <!-- Page -->
        <div class="container-fluid pt-4 px-4" style="max-width:1200px">
            <div class="page-header mb-3">
                <h4 class="m-0">PV-002 ‚Ä¢ Thi·∫øt l·∫≠p g√≥i & b·∫£ng gi√°</h4>
            </div>

            <!-- Card: package + per-km -->
            <div class="card app-card mb-3">
                <div class="card-body p-4">
                    <div class="row g-3 align-items-end">
                        <div class="col-lg-5">
                            <label class="form-label"><i class="bi bi-box2-heart me-2"></i>G√≥i v·∫≠n chuy·ªÉn</label>
                            <select id="packageSelect" class="form-select" aria-label="Ch·ªçn g√≥i"></select>
                            <div id="packageSelectFeedback" class="invalid-feedback d-none">Vui l√≤ng ch·ªçn g√≥i.</div>
                        </div>
                        <div class="col-lg-4">
                            <label class="form-label"><i class="bi bi-signpost-2 me-2"></i>Gi√° / km (ƒë)</label>
                            <input id="pricePerKm" type="number" min="0" step="1000" class="form-control" placeholder="vd: 100000">
                            <div id="pricePerKmFeedback" class="invalid-feedback d-none">Gi√°/km ph·∫£i l√† s·ªë ‚â• 0.</div>
                        </div>
                        <div class="col-lg-3">
                            <button id="saveAllBtn" class="btn btn-primary w-100" type="button">
                                <i class="bi bi-check2-circle me-1"></i>L∆∞u c·∫•u h√¨nh
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Card: furniture table -->
            <div class="card app-card">
                <div class="card-body p-4">
                    <div class="toolbar mb-3 d-flex flex-wrap gap-2 align-items-center">
                        <input id="filterInput" type="search" class="form-control" placeholder="üîç L·ªçc theo t√™n..." style="max-width:240px">
                        <input id="bulkValue" type="number" class="form-control" min="0" step="1000" placeholder="√Åp 1 gi√° cho t·∫•t c·∫£" style="max-width:200px">
                        <button id="applyBulkBtn" class="btn btn-outline-secondary" type="button"><i class="bi bi-arrow-down-square me-1"></i>√Åp d·ª•ng</button>
                        <button id="clearAllBtn" class="btn btn-outline-danger" type="button"><i class="bi bi-eraser me-1"></i>Xo√° t·∫•t c·∫£ gi√°</button>
                    </div>

                    <!-- Add new item -->
                    <div class="add-item-section mb-3">
                        <div class="row g-2 align-items-end">
                            <div class="col-md-5">
                                <label class="form-label mb-1">T√™n n·ªôi th·∫•t</label>
                                <input id="addItemName" type="text" class="form-control" placeholder="VD: Sofa, t·ªß qu·∫ßn √°o...">
                                <div id="addItemNameFeedback" class="invalid-feedback d-none">T√™n n·ªôi th·∫•t kh√¥ng ƒë∆∞·ª£c tr·ªëng v√† &le; 100 k√Ω t·ª±.</div>
                            </div>
                            <div class="col-md-4">
                                <label class="form-label mb-1">Gi√° (ƒë)</label>
                                <input id="addItemPrice" type="number" min="0" step="1000" class="form-control" placeholder="VD: 1000000">
                                <div id="addItemPriceFeedback" class="invalid-feedback d-none">Gi√° ph·∫£i l√† s·ªë ‚â• 0.</div>
                            </div>
                            <div class="col-md-3">
                                <button id="addItemBtn" class="btn btn-outline-primary w-100" type="button">
                                    <i class="bi bi-plus-lg me-1"></i>Th√™m n·ªôi th·∫•t
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-hover align-middle mb-0">
                            <thead>
                            <tr>
                                <th style="width:60%">T√™n n·ªôi th·∫•t</th>
                                <th style="width:40%">Gi√° (ƒë)</th>
                            </tr>
                            </thead>
                            <tbody id="itemsBody"></tbody>
                        </table>
                    </div>

                    <div class="text-end mt-4">
                        <button id="saveTableBtn" class="btn btn-success btn-lg" type="button">
                            <i class="bi bi-save me-1"></i>L∆∞u b·∫£ng gi√°
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div class="container-fluid pt-4 px-4">
            <div class="bg-light rounded-top p-4">
                <div class="row">
                    <div class="col-12 col-sm-6 text-center text-sm-start">&copy; Your Site</div>
                    <div class="col-12 col-sm-6 text-center text-sm-end">Designed by DuongTD</div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Backdrop for overlay sidebar -->
<div id="sidebar-backdrop" aria-hidden="true"></div>

<!-- Loading overlay -->
<div id="loadingOverlay" class="loading-overlay">
    <div class="spinner-border text-light" role="status"></div>
</div>

<!-- JS: jQuery, Bootstrap, dashboard main, page script -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/dashbooard/js/main.js}"></script>
<script th:src="@{/provider/js/provider-services.js}" defer></script>

<script>
    // Toggle sidebar + backdrop
    (function () {
        var $s = $('.sidebar'), $b = $('#sidebar-backdrop');
        function sync() { $b.toggleClass('show', $s.hasClass('open')); }
        sync();
        try { new MutationObserver(sync).observe($s.get(0), {attributes: true, attributeFilter: ['class']}); }
        catch(e){ setInterval(sync, 250); }
        $(document).on('click', '#sidebar-backdrop', function(){ $s.removeClass('open'); sync(); });
    })();
    // Theme toggle
    (function () {
        const btn = document.getElementById('theme-toggle');
        function apply(dark){
            document.documentElement.classList.toggle('dark', dark);
            document.documentElement.dataset.theme = dark ? 'dark' : 'light';
            localStorage.setItem('theme', dark ? 'dark' : 'light');
            btn.innerHTML = dark
                ? '<i class="bi bi-sun me-1"></i><span>Light</span>'
                : '<i class="bi bi-moon-stars me-1"></i><span>Dark</span>';
        }
        btn.addEventListener('click', ()=>apply(!(document.documentElement.dataset.theme==='dark')));
        // initial label
        apply(document.documentElement.dataset.theme==='dark');
    })();
</script>
</body>
</html>
