<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>PV-002 ‚Ä¢ B·∫£ng gi√° & D·ªãch v·ª•</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Inject t·ª´ controller -->
    <meta name="provider-id" th:content="${providerId}"/>

    <!-- Early theme boot -->
    <script>
        (function(){
            try{
                var s = localStorage.getItem('theme');
                var prefers = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
                document.documentElement.classList.toggle('dark', s ? s === 'dark' : prefers);
            }catch(e){}
        })();
    </script>

    <!-- Dashboard CSS -->
    <link rel="stylesheet" th:href="@{/dashbooard/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/dashbooard/css/style.css}">
    <link rel="stylesheet" th:href="@{/dashbooard/css/dashboard.css}">
    <link rel="stylesheet" th:href="@{/dashbooard/css/theme.css}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css">

    <!-- PV-002 CSS -->
    <link rel="stylesheet" th:href="@{/provider/css/provider-services.css}">
</head>

<body>
<div class="container-fluid position-relative d-flex p-0">

    <!-- Sidebar -->
    <div class="sidebar pe-4 pb-3">
        <nav class="navbar bg-light navbar-light">
            <a th:href="@{/provider/dashboard}" class="navbar-brand mx-4 mb-3">
                <h3 class="text-primary"><i class="fa fa-hashtag me-2"></i>ProviderOP</h3>
            </a>

            <div class="d-flex align-items-center ms-4 mb-4">
                <div class="position-relative">
                    <img class="rounded-circle" th:src="@{/images/loginbg.jpg}" alt="avatar"
                         style="width:40px;height:40px;">
                    <div class="bg-success rounded-circle border border-2 border-white position-absolute end-0 bottom-0 p-1"></div>
                </div>
                <div class="ms-3">
                    <h6 class="mb-0"
                        th:text="${companyName != null && !#strings.isEmpty(companyName) ? companyName : #authentication?.name}">
                        provider1
                    </h6>
                    <span>Provider</span>
                </div>
            </div>

            <div class="navbar-nav w-100">
                <a th:href="@{/provider/dashboard}" class="nav-item nav-link">
                    <i class="bi bi-speedometer2 me-2"></i>T·ªïng quan</a>
                <a th:href="@{/provider/services}" class="nav-item nav-link active">
                    <i class="bi bi-gear-wide-connected me-2"></i>B·∫£ng gi√° & d·ªãch v·ª•</a>
                <a th:href="@{/provider/orders}" class="nav-item nav-link"><i class="bi bi-box-seam me-2"></i>ƒê∆°n h√†ng</a>
                <a th:href="@{/provider/analytics}" class="nav-item nav-link"><i class="bi bi-graph-up me-2"></i>Ph√¢n t√≠ch</a>
            </div>
        </nav>
    </div>

    <!-- Content -->
    <div class="content">
        <!-- Top Navbar -->
        <nav class="navbar navbar-expand bg-light navbar-light sticky-top px-4 py-0">
            <a th:href="@{/provider/dashboard}" class="navbar-brand d-flex d-lg-none me-4">
                <h2 class="text-primary mb-0"><i class="fa fa-hashtag"></i></h2>
            </a>
            <a href="#" class="sidebar-toggler flex-shrink-0" aria-label="Toggle sidebar">
                <i class="fa fa-bars"></i>
            </a>

            <form class="d-none d-md-flex ms-4" role="search">
                <input class="form-control border-0" type="search" placeholder="T√¨m ki·∫øm nhanh‚Ä¶">
            </form>

            <div class="navbar-nav align-items-center ms-auto">
                <button id="theme-toggle" class="btn btn-sm btn-outline-secondary me-2" type="button"
                        aria-pressed="false">üåô Dark
                </button>

                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                        <i class="fa fa-bell me-lg-2"></i>
                        <span class="d-none d-lg-inline-flex">Notification</span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-end bg-light border-0 rounded-0 rounded-bottom m-0">
                        <a href="#" class="dropdown-item"><h6 class="fw-normal mb-0">Kh√¥ng c√≥ th√¥ng b√°o</h6><small>‚Äî</small></a>
                    </div>
                </div>

                <div class="nav-item dropdown">
                    <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown">
                        <img class="rounded-circle me-lg-2" th:src="@{/images/loginbg.jpg}" alt=""
                             style="width:40px;height:40px;">
                        <span class="d-none d-lg-inline-flex"
                              th:text="${companyName != null && !#strings.isEmpty(companyName) ? companyName : #authentication?.name}">
                            provider1
                        </span>
                    </a>
                    <div class="dropdown-menu dropdown-menu-end bg-light border-0 rounded-0 rounded-bottom m-0">
                        <a class="dropdown-item" href="/provider/profile">H·ªì s∆°</a>
                        <a class="dropdown-item" href="/provider/settings">C√†i ƒë·∫∑t</a>
                        <div class="dropdown-divider"></div>
                        <form th:action="@{/logout}" method="post" id="logoutForm"></form>
                        <a href="#" class="dropdown-item"
                           onclick="document.getElementById('logoutForm').submit(); return false;">ƒêƒÉng xu·∫•t</a>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Page Body -->
        <div class="container-fluid pt-4 px-4">
            <div class="d-flex justify-content-between align-items-center mb-3">
                <h3 class="m-0 text-shadow">PV-002 ‚Ä¢ Thi·∫øt l·∫≠p g√≥i & b·∫£ng gi√°</h3>
                <div>
                    <button class="btn btn-outline-light btn-sm me-2" id="btnRefresh">
                        <i class="bi bi-arrow-clockwise"></i> L√†m m·ªõi
                    </button>
                    <button class="btn btn-primary btn-sm" id="btnOpenAdd">
                        <i class="bi bi-plus-lg"></i> Th√™m g√≥i
                    </button>
                </div>
            </div>

            <div class="row g-3">
                <!-- LEFT -->
                <div class="col-lg-4">
                    <div class="card-dark p-3 h-100">
                        <div class="d-flex align-items-center justify-content-between mb-2">
                            <div>
                                <div class="fw-semibold">G√≥i ƒë√£ c·∫•u h√¨nh</div>
                                <div class="small muted">Ch·ªçn ƒë·ªÉ m·ªü & ch·ªânh s·ª≠a</div>
                            </div>
                            <span id="configuredCount" class="badge badge-dim"></span>
                        </div>

                        <div class="row g-2 mb-2">
                            <div class="col-12">
                                <select id="filterByPackage" class="form-select form-select-sm">
                                    <option value="">L·ªçc theo g√≥i g·ªëc (T·∫•t c·∫£)</option>
                                </select>
                            </div>
                        </div>

                        <div class="input-group input-group-sm mb-2">
                            <span class="input-group-text bg-transparent text-light border-secondary">
                                <i class="bi bi-search"></i>
                            </span>
                            <input id="searchConfigured"
                                   class="form-control bg-transparent text-light border-secondary"
                                   placeholder="T√¨m theo t√™n snapshot...">
                        </div>

                        <div class="list-group list-hover" id="configuredList"
                             style="max-height:66vh;overflow:auto;"></div>
                    </div>
                </div>

                <!-- RIGHT -->
                <div class="col-lg-8">
                    <div class="card-dark p-3 h-100">
                        <div class="d-flex align-items-center justify-content-between mb-3">
                            <div>
                                <div class="fw-semibold">Chi ti·∫øt g√≥i</div>
                                <div class="small muted">Gi√°/km & b·∫£ng gi√° n·ªôi th·∫•t (snapshot)</div>
                            </div>
                            <div>
                                <button class="btn btn-outline-danger btn-sm me-2" id="btnDelete">
                                    <i class="bi bi-trash"></i> X√≥a g√≥i
                                </button>
                                <button class="btn btn-outline-warning btn-sm me-2" id="btnReset">
                                    <i class="bi bi-eraser"></i> ƒê·∫∑t l·∫°i gi√°
                                </button>
                                <button class="btn btn-success btn-sm" id="btnSave">
                                    <i class="bi bi-save2"></i> L∆∞u
                                </button>
                            </div>
                        </div>

                        <div id="emptyHint" class="alert alert-dark border-secondary small">
                            H√£y ch·ªçn m·ªôt g√≥i ·ªü c·ªôt b√™n tr√°i ho·∫∑c b·∫•m <b>Th√™m g√≥i</b> ƒë·ªÉ kh·ªüi t·∫°o c·∫•u h√¨nh.
                        </div>

                        <form id="detailForm" class="d-none" novalidate>
                            <div class="row g-3 mb-2">
                                <div class="col-md-6">
                                    <label class="form-label">T√™n g√≥i (snapshot khi l∆∞u)</label>
                                    <input id="packageNameSnapshot" class="form-control" maxlength="120"
                                           placeholder="VD: V·∫≠n chuy·ªÉn vƒÉn ph√≤ng ‚Äî HCM"/>
                                    <div class="form-text muted">
                                        ƒê·ªÉ tr·ªëng s·∫Ω d√πng t√™n g·ªëc t·ª´ <code>service_packages</code>.
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <label class="form-label">Gi√° m·ªói km</label>
                                    <input id="pricePerKm" class="form-control" type="number" step="1000" min="0"
                                           placeholder="VD: 100000"/>
                                </div>
                            </div>

                            <div class="d-flex align-items-center justify-content-between mt-2 mb-2">
                                <h6 class="m-0">B·∫£ng gi√° n·ªôi th·∫•t</h6>
                                <button type="button" class="btn btn-sm btn-outline-light" id="btnAddRow">
                                    <i class="bi bi-plus"></i> Th√™m d√≤ng
                                </button>
                            </div>

                            <div class="table-responsive" style="max-height:50vh;overflow:auto;">
                                <table class="table table-dark table-striped align-middle" id="itemsTable">
                                    <thead>
                                    <tr>
                                        <th style="width:40%">T√™n n·ªôi th·∫•t</th>
                                        <th style="width:30%">Gi√° (VNƒê)</th>
                                        <th style="width:30%">Thao t√°c</th>
                                    </tr>
                                    </thead>
                                    <tbody></tbody>
                                </table>
                            </div>
                        </form>
                    </div>
                </div>
            </div> <!-- /row -->
        </div> <!-- /container -->

        <!-- Footer -->
        <div class="container-fluid pt-4 px-4">
            <div class="bg-light rounded-top p-4">
                <div class="row">
                    <div class="col-12 col-sm-6 text-center text-sm-start">
                        &copy; <a href="#">Your Site Name</a>, All Right Reserved.
                    </div>
                    <div class="col-12 col-sm-6 text-center text-sm-end">
                        Designed By
                        <a href="https://www.facebook.com/duong.tran.inh.361877/">DuongTD</a>
                    </div>
                </div>
            </div>
        </div>
    </div> <!-- /content -->
</div> <!-- /container-fluid -->

<!-- Backdrop -->
<div id="sidebar-backdrop" aria-hidden="true"></div>

<!-- Toasts -->
<div id="toastBox" class="toast-box"></div>

<!-- Modal: Th√™m g√≥i -->
<div class="modal fade" id="addPkgModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Th√™m snapshot g√≥i</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="ƒê√≥ng"></button>
            </div>
            <div class="modal-body">
                <div class="mb-2">
                    <label class="form-label">Ch·ªçn g√≥i g·ªëc</label>
                    <select id="modalPackageSelect" class="form-select"></select>
                    <div class="form-text muted">C√≥ th·ªÉ t·∫°o nhi·ªÅu snapshot cho c√πng m·ªôt g√≥i.</div>
                </div>
                <div>
                    <label class="form-label">Gi√°/km ban ƒë·∫ßu (tu·ª≥ ch·ªçn)</label>
                    <input id="modalPerKm" class="form-control" type="number" step="1000" min="0"
                           placeholder="VD: 100000">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline-secondary" data-bs-dismiss="modal">ƒê√≥ng</button>
                <button class="btn btn-primary" id="btnCreatePkg">T·∫°o</button>
            </div>
        </div>
    </div>
</div>

<!-- JS: jQuery -> Bootstrap -> dashboard main -> page JS -->
<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script th:src="@{/dashbooard/js/main.js}"></script>
<script th:src="@{/provider/js/provider-services.js}"></script>

<!-- Backdrop sync -->
<script>
    (function () {
        var $sidebar = $('.sidebar');
        var $backdrop = $('#sidebar-backdrop');
        function sync(){ $backdrop.toggleClass('show', $sidebar.hasClass('open')); }
        sync();
        try {
            new MutationObserver(sync).observe($sidebar.get(0), {attributes:true, attributeFilter:['class']});
        } catch (e) { setInterval(sync, 250); }
        $(document).off('click.provider-backdrop').on('click.provider-backdrop','#sidebar-backdrop',function(){
            $sidebar.removeClass('open'); sync();
        });
    })();
</script>
</body>
</html>
