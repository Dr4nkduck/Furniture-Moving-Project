<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Provider Dashboard</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style>
        :root{
            --bg:#0b1220; --card:#0f172a; --fg:#e5e7eb; --muted:#94a3b8; --line:#1f2937;
            --accent:#22d3ee; --ok:#34d399; --warn:#fca5a5; --btn:#0b1628;
        }
        *{box-sizing:border-box}
        body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,Arial}
        .shell{max-width:1200px;margin:0 auto;padding:24px}
        header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
        .brand{font-weight:800;font-size:20px;letter-spacing:.3px}
        .nav a{color:var(--muted);text-decoration:none;margin-left:14px}
        .grid{display:grid;grid-template-columns:repeat(4,1fr);gap:14px}
        .card{background:var(--card);border:1px solid var(--line);border-radius:16px;padding:16px}
        .k{font-size:13px;color:var(--muted)}
        .v{font-size:26px;font-weight:800;margin-top:6px}
        .quick{display:grid;grid-template-columns:repeat(3,1fr);gap:14px;margin-top:18px}
        .btn{display:flex;gap:8px;align-items:center;justify-content:center;
            background:var(--btn);border:1px solid var(--line);border-radius:14px;
            padding:14px;text-decoration:none;color:var(--fg);font-weight:700}
        .btn:hover{border-color:#263242}
        .section{margin-top:24px}
        .list{display:grid;gap:10px}
        .row{display:flex;justify-content:space-between;align-items:center;padding:12px;border:1px solid var(--line);border-radius:12px;background:var(--card)}
        .sub{color:var(--muted)}
        @media (max-width:980px){ .grid{grid-template-columns:repeat(2,1fr)} .quick{grid-template-columns:1fr 1fr} }
        @media (max-width:640px){ .grid{grid-template-columns:1fr} .quick{grid-template-columns:1fr} }
    </style>
</head>
<body>
<div class="shell">
    <header>
        <div class="brand">Provider ‚Ä¢ Dashboard</div>
        <nav class="nav">
            <a href="/provider/services">Pricing</a>
            <a href="/provider/orders">Orders</a>
            <a href="/logout">Logout</a>
        </nav>
    </header>

    <!-- KPI -->
    <div class="grid">
        <div class="card"><div class="k">T·ªïng ƒë∆°n</div><div id="kpi-total" class="v">‚Äì</div></div>
        <div class="card"><div class="k">ƒêang ch·ªù (Assigned)</div><div id="kpi-assigned" class="v">‚Äì</div></div>
        <div class="card"><div class="k">ƒêang ch·∫°y</div><div id="kpi-progress" class="v">‚Äì</div></div>
        <div class="card"><div class="k">Ho√†n t·∫•t</div><div id="kpi-done" class="v">‚Äì</div></div>
    </div>

    <!-- Quick actions -->
    <div class="section">
        <div class="quick">
            <a class="btn" href="/provider/services">‚öôÔ∏è C·∫•u h√¨nh gi√° (PV-002)</a>
            <a class="btn" href="/provider/orders">üì¶ ƒê∆°n h√†ng (PV-003)</a>
            <a class="btn" href="/provider/orders">üß≠ Theo d√µi / C·∫≠p nh·∫≠t (PV-004/005)</a>
        </div>
    </div>

    <!-- G·ª£i √Ω ƒë∆°n g·∫ßn nh·∫•t -->
    <div class="section">
        <div class="card" style="margin-bottom:12px"><b>ƒê∆°n g·∫ßn ƒë√¢y</b></div>
        <div id="recent" class="list"></div>
    </div>
</div>

<script>
    const providerId = new URLSearchParams(location.search).get('providerId') || ''; // TEST nhanh

    async function loadKpi(){
        try{
            const res = await fetch('/api/provider/dashboard/summary' + (providerId? ('?providerId='+providerId):''));
            const d = await res.json();
            document.getElementById('kpi-total').textContent    = d.total ?? 0;
            document.getElementById('kpi-assigned').textContent = d.assigned ?? 0;
            document.getElementById('kpi-progress').textContent = d.in_progress ?? 0;
            document.getElementById('kpi-done').textContent     = d.completed ?? 0;
        }catch(e){}
    }

    async function loadRecent(){
        try{
            const res = await fetch('/api/providers/orders' + (providerId? ('?providerId='+providerId):''));
            const list = await res.json();
            const rec = document.getElementById('recent');
            rec.innerHTML='';
            (list || []).slice(0,5).forEach(o=>{
                const div = document.createElement('div');
                div.className='row';
                div.innerHTML = `
        <div>
          <div><b>#${o.requestId}</b> ¬∑ ${o.routeSummary || 'Pickup ‚Üí Delivery'}</div>
          <div class="sub">${o.status} ¬∑ ${o.scheduledAt ?? ''} ¬∑ ${o.customerShort ?? ''}</div>
        </div>
        <a class="btn" style="padding:8px 12px" href="/provider/orders/${o.requestId}">Chi ti·∫øt</a>
      `;
                rec.appendChild(div);
            });
        }catch(e){}
    }

    loadKpi();
    loadRecent();
</script>
</body>
</html>
