<!DOCTYPE html>
<html lang="vi" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <title>PV-003 ‚Ä¢ ƒê∆°n v·∫≠n chuy·ªÉn</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- CSRF cho c√°c request POST/PUT/DELETE (n·∫øu c√≥ _csrf) -->
    <meta name="_csrf" th:if="${_csrf != null}" th:content="${_csrf.token}">
    <meta name="_csrf_header" th:if="${_csrf != null}" th:content="${_csrf.headerName}">

    <!-- (tu·ª≥) inject providerId n·∫øu b·∫°n ƒë√£ c√≥ t·ª´ backend -->
    <meta name="provider-id" th:content="${providerId}"/>

    <!-- Vendor -->
    <link rel="stylesheet" th:href="@{/dashbooard/css/bootstrap.min.css}">
    <link rel="stylesheet" th:href="@{/dashbooard/css/theme.css}">

    <!-- Layout + Page styles -->
    <link rel="stylesheet" th:href="@{/provider/css/provider-layout.css}">
    <link rel="stylesheet" th:href="@{/provider/css/provider-orders.css}">
</head>
<body>

<div class="page-app">
    <!-- Sidebar -->
    <aside class="sidebar">
        <div class="brand"><i class="bi bi-hash"></i> ProviderOP</div>
        <div class="avatar">
            <img th:src="@{/images/loginbg.jpg}" alt="avatar" style="width:36px;height:36px;border-radius:50%">
            <div>
                <div th:text="${#authentication?.name}">provider1</div>
                <small style="color:var(--muted)">Provider</small>
            </div>
        </div>
        <nav>
            <ul class="nav">
                <li><a th:href="@{/provider/dashboard}"><i class="bi bi-speedometer2"></i> T·ªïng quan</a></li>
                <li><a th:href="@{/provider/services}"><i class="bi bi-gear-wide-connected"></i> B·∫£ng gi√° & d·ªãch v·ª•</a></li>
                <li><a th:href="@{/provider/orders}"><i class="bi bi-box-seam"></i> ƒê∆°n h√†ng</a></li>
                <li><a th:href="@{/provider/analytics}"><i class="bi bi-graph-up"></i> Ph√¢n t√≠ch</a></li>
            </ul>
        </nav>
    </aside>

    <!-- Content -->
    <main class="content">
        <!-- Topbar -->
        <div class="topbar">
            <button class="sidebar-toggler" aria-label="Toggle sidebar"><i class="bi bi-list"></i></button>
            <div class="search"><input type="search" placeholder="T√¨m ki·∫øm nhanh‚Ä¶"></div>
            <button id="theme-toggle" type="button">üåô Dark</button>
            <div class="ms-auto"></div>
            <a href="/logout" class="btn btn-sm btn-outline-secondary">ƒêƒÉng xu·∫•t</a>
        </div>

        <!-- Page body -->
        <div class="container-xl py-4">
            <div class="header d-flex align-items-center justify-content-between mb-3">
                <h1 class="h4 m-0">ƒê∆°n v·∫≠n chuy·ªÉn</h1>
                <div class="d-flex gap-2">
                    <input id="searchInput" class="form-control" placeholder="T√¨m theo #ID, t√™n KH, ƒë·ªãa ch·ªâ...">
                    <select id="statusFilter" class="form-select">
                        <option value="">T·∫•t c·∫£ tr·∫°ng th√°i</option>
                        <option value="pending">Ch·ªù x√°c nh·∫≠n</option>
                        <option value="ready_to_pay">Ch·ªù kh√°ch thanh to√°n</option>
                        <option value="paid">ƒê√£ thanh to√°n</option>
                        <option value="in_progress">ƒêang v·∫≠n chuy·ªÉn</option>
                        <option value="completed">Ho√†n th√†nh</option>
                        <option value="declined">ƒê√£ t·ª´ ch·ªëi</option>
                        <option value="cancelled">ƒê√£ h·ªßy</option>
                    </select>
                    <button id="btnRefresh" class="btn btn-primary">L·ªçc</button>
                </div>
            </div>

            <div class="orders-layout">
                <div class="orders card-dark">
                    <div class="table-responsive">
                        <table class="table table-hover align-middle m-0">
                            <thead>
                            <tr>
                                <th>#ID</th>
                                <th>Kh√°ch h√†ng</th>
                                <th>L·∫•y h√†ng</th>
                                <th>Giao h√†ng</th>
                                <th>Ng√†y chuy·ªÉn</th>
                                <th>Tr·∫°ng th√°i</th>
                                <!-- üîπ C·ªôt m·ªõi: m√£ thanh to√°n REQ(id) ƒë·ªÉ ƒë·ªëi so√°t sao k√™ -->
                                <th>M√£ thanh to√°n (REQ)</th>
                                <th class="text-end">∆Ø·ªõc t√≠nh</th>
                            </tr>
                            </thead>
                            <tbody id="ordersTbody"></tbody>
                        </table>
                    </div>
                </div>

                <div class="detail card-dark">
                    <div id="emptyDetail" class="p-3 text-muted">Ch·ªçn m·ªôt ƒë∆°n ƒë·ªÉ xem chi ti·∫øt.</div>
                    <div id="detailContent" class="p-3 d-none">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <div>
                                <h2 class="h6 mb-1">
                                    ƒê∆°n #<span id="d-id"></span>
                                </h2>
                                <!-- üîπ Hi·ªÉn th·ªã REQ(id) trong panel chi ti·∫øt -->
                                <div class="small text-muted">
                                    M√£ thanh to√°n: <code id="d-paymentRef">REQ123</code>
                                </div>
                            </div>
                            <span class="badge" id="d-status"></span>
                        </div>

                        <div class="row g-3 mb-3">
                            <div class="col-md-6">
                                <div class="small text-muted">Kh√°ch h√†ng</div>
                                <div id="d-customer"></div>
                                <div class="small text-muted" id="d-contact"></div>
                            </div>
                            <div class="col-md-6 text-md-end">
                                <div class="small text-muted">Ng√†y chuy·ªÉn</div>
                                <div id="d-date"></div>
                                <div class="small text-muted">∆Ø·ªõc t√≠nh</div>
                                <div id="d-cost" class="fw-semibold"></div>
                            </div>
                        </div>

                        <div class="mb-3">
                            <div><strong>L·∫•y:</strong> <span id="d-pickup"></span></div>
                            <div><strong>Giao:</strong> <span id="d-delivery"></span></div>
                        </div>

                        <div class="timeline mb-3" id="d-timeline"></div>

                        <h3 class="h6 mt-4 mb-2">N·ªôi th·∫•t v·∫≠n chuy·ªÉn</h3>
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                <tr>
                                    <th>T√™n</th>
                                    <th>K√≠ch th∆∞·ªõc</th>
                                    <th>S·ªë l∆∞·ª£ng</th>
                                    <th>Fragile</th>
                                </tr>
                                </thead>
                                <tbody id="d-items"></tbody>
                            </table>
                        </div>

                        <div class="actions d-flex gap-2 mt-3">
                            <button class="btn btn-outline-secondary" data-act="accepted">Ghi nh·∫≠n h·ª£p ƒë·ªìng</button>
                            <button class="btn btn-outline-primary" data-act="in_progress">B·∫Øt ƒë·∫ßu v·∫≠n chuy·ªÉn</button>
                            <button class="btn btn-success" data-act="completed">Ho√†n th√†nh</button>

                            <!-- N√öT M·ªöI: Provider x√°c nh·∫≠n ƒë√£ nh·∫≠n ti·ªÅn -->
                            <button class="btn btn-warning" id="btnConfirmPaid" type="button">
                                X√°c nh·∫≠n ƒë√£ thanh to√°n
                            </button>

                            <button class="btn btn-danger" data-act="cancelled">H·ªßy ƒë∆°n</button>
                            <button class="btn btn-outline-danger ms-auto" data-act="declined">T·ª´ ch·ªëi</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- /Page body -->
    </main>
</div>

<!-- Backdrop (auto-created in JS n·∫øu thi·∫øu) -->
<div id="sidebar-backdrop"></div>

<!-- Vendor -->
<script th:src="@{/dashbooard/js/main.js}"></script>

<!-- Layout JS then page JS -->
<script th:src="@{/provider/js/provider-layout.js}"></script>
<script th:src="@{/provider/js/provider-orders.js}"></script>
</body>
</html>
